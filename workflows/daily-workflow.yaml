main:
    steps:
    - init:
        assign:
        - repository: projects/noon-secops-stg/locations/us-central1/repositories/CSA-Dataform-workflow
    - createCompilationResult:
        call: http.post
        args:
            url: ${"https://dataform.googleapis.com/v1beta1/" + repository + "/compilationResults"}
            headers:
                User-Agent: "cloud-solutions/security-analytics-usage-v1"
            auth:
                type: OAuth2
            body:
                gitCommitish: main
        result: compilationResult
    - createWorkflowInvocation:
        call: http.post
        args:
            url: ${"https://dataform.googleapis.com/v1beta1/" + repository + "/workflowInvocations"}
            headers:
                User-Agent: "cloud-solutions/security-analytics-usage-v1"
            auth:
                type: OAuth2
            body:
                compilationResult: ${compilationResult.body.name}
                invocationConfig:
                    includedTags:
                    - daily
                    transitiveDependenciesIncluded: true
        result: workflowInvocation
    - complete:
        return: ${workflowInvocation.body.name}
